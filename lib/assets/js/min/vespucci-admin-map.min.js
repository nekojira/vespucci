!function($){"use strict";$(function(){var tabDiv=$("#vespucci-location-tabs"),tabDivLi=$(tabDiv).find("li");$(tabDiv).tabs().addClass("ui-tabs-vertical ui-helper-clearfix"),$(tabDivLi).removeClass("ui-corner-top").addClass("ui-corner-left")}),$(function(){function GeoCode(string){$.getJSON("http://nominatim.openstreetmap.org/search.php?q="+string+"&addressdetails=1&format=jsonv2",function(data){var result=data[0];if("undefined"!=typeof result){"undefined"!=typeof result.display_name&&LocationName.val(result.display_name);var coordinates={lat:parseFloat(result.lat),lng:parseFloat(result.lon)};return LocationMarker(coordinates),$.each(LocationAddress,function(){this.val("")}),"undefined"!=typeof result.address&&UpdateAddress(result.address),result}})}function ReverseGeoCode(point){isNaN(point.lat||isNaN(point.lng))||$.getJSON(" http://nominatim.openstreetmap.org/reverse?lat="+point.lat+"&lon="+point.lng+"addressdetails=1&format=jsonv2",function(result){return LocationName.val(result.display_name),$.each(LocationAddress,function(){this.val("")}),"undefined"!=typeof result.address&&UpdateAddress(result.address),result})}function UpdateAddress(QueriedAddress){$.each(QueriedAddress,function(key,value){switch(key){case"house_number":LocationAddress.street.val(value+" ");break;case"road":LocationAddress.street.val(LocationAddress.street.val()+value);break;case"neighbourhood":LocationAddress.area.val(value+" ");break;case"suburb":LocationAddress.area.val(LocationAddress.area.val()+value);break;case"city":case"town":case"village":case"hamlet":LocationAddress.city.val(value);break;case"county":case"province":LocationAddress.district.val(value);break;case"state":LocationAddress.state.val(value);break;case"postcode":LocationAddress.postcode.val(value);break;case"country":LocationAddress.country.val(value);break;case"countrycode":case"country_code":CountryCode.val(value)}})}function LocationMarker(point){if(!isNaN(point.lat)&&!isNaN(point.lng)){var latlng=[point.lat,point.lng];"undefined"==typeof marker?(marker=new L.marker(latlng,{draggable:!0}),marker.addTo(map)):marker.setLatLng(latlng),map.setView(latlng,map.getZoom()),lat.val(point.lat),lng.val(point.lng)}}var lat=$("#vespucci-location-lat"),lng=$("#vespucci-location-lng");if("undefined"==typeof lat.val()||"undefined"==typeof lng.val())return!1;var LocationAddress={street:$("#vespucci-location-address-street"),area:$("#vespucci-location-address-area"),city:$("#vespucci-location-address-city"),district:$("#vespucci-location-address-district"),state:$("#vespucci-location-address-state"),postcode:$("#vespucci-location-address-postcode"),country:$("#vespucci-location-address-country")},CountryCode=$("#vespucci-location-code"),LocationZoom={"default":$("#vespucci-map-zoom-default"),min:$("#vespucci-map-zoom-min"),max:$("#vespucci-map-zoom-max")},map=new L.Map("vespucci-location-map",{center:new L.LatLng(lat.val(),lng.val()),zoom:parseInt(LocationZoom.default.val(),10)}),googleRoadmap=new L.Google("ROADMAP"),googleSatellite=new L.Google("SATELLITE"),googleTerrain=new L.Google("TERRAIN"),defaultMapType=$("#vespucci-google-map-type");"terrain"===defaultMapType.val()?map.addLayer(googleTerrain):"satellite"===defaultMapType.val()?map.addLayer(googleSatellite):map.addLayer(googleRoadmap),map.addControl(new L.Control.Layers({Roadmap:googleRoadmap,Terrain:googleTerrain,Satellite:googleSatellite},{}));var marker;if("0"!==lat.val()&&"0"!==lng.val()){var point={lat:lat.val(),lng:lng.val()};LocationMarker(point)}var LocationName=$("#vespucci-location-title");LocationName.keydown(function(key){13===key.which&&(key.preventDefault(),LocationName.val().length>1&&(GeoCode(LocationName.val()),map.setZoom(14)))}),$("#vespucci-geocode-request").on("click",function(){LocationName.val().length>1&&GeoCode(LocationName.val())}),$("#vespucci-user-location").on("click",function(){map.locate({setView:!0,maxZoom:16})}),map.on("mouseover",function(){"undefined"!=typeof marker&&marker.on("dragend",function(){var point=marker.getLatLng();lat.val(point.lat),lng.val(point.lng),ReverseGeoCode(point)})}),map.on("click",function(e){var point={lat:parseFloat(e.latlng.lat),lng:parseFloat(e.latlng.lng)};LocationMarker(point),ReverseGeoCode(point)}),map.on("zoomend",function(){var zoomLevel=parseInt(this.getZoom(),10);LocationZoom.default.val(zoomLevel)}),map.on("locationfound",function(e){var point={lat:parseFloat(e.latlng.lat),lng:parseFloat(e.latlng.lng)};LocationMarker(point),ReverseGeoCode(point)}),map.on("locationerror",function(e){alert(e.message)})})}(jQuery);